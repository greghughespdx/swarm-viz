{"type":"convention","content":"swarm-viz server defaults to port 3000 (not 3001). client/index.html is the entry point referencing main.js. bun-types must be installed (bun install) before typecheck passes.","classification":"tactical","recorded_at":"2026-02-17T05:29:26.057Z","id":"mx-cff751"}
{"type":"pattern","name":"viz-protocol-layer","description":"DB types stay internal (DbMergeQueueEntry), viz wire types are clean (Agent, AgentMessage, MergeQueueEntry). Server mappers (toAgent, toAgentMessage, toVizMergeEntry, computeMetrics) bridge the gap. Client never sees DB types.","classification":"tactical","recorded_at":"2026-02-17T06:02:29.313Z","id":"mx-350a4d"}
{"type":"convention","content":"When DB type name conflicts with viz protocol type, prefix DB type with Db (e.g., DbMergeQueueEntry vs MergeQueueEntry). DB-internal types get the Db prefix; viz wire types keep the clean name.","classification":"tactical","recorded_at":"2026-02-17T05:53:49.328Z","evidence":{"commit":"abbed77"},"id":"mx-16f124"}
{"type":"convention","content":"When DB type name conflicts with viz protocol type, prefix DB type with Db (e.g., DbMergeQueueEntry vs MergeQueueEntry). Viz types own the clean names since they're the public API.","classification":"tactical","recorded_at":"2026-02-17T06:02:30.531Z","id":"mx-d5240f"}
{"type":"convention","content":"swarm-viz build script must cp client/index.html dist/index.html after bun build, otherwise the server's static file handler returns 'Not Found' for the root route. Build script: 'bun build client/main.ts --outdir dist --minify && cp client/index.html dist/index.html'","classification":"tactical","recorded_at":"2026-02-17T06:24:26.004Z","evidence":{"commit":"b6c526e"},"id":"mx-57d586"}
{"type":"convention","content":"swarm-viz toggle keys per spec: L=agent labels, M=message labels, G=group clustering. HUD panel in bottom-right corner. When builder branches conflict, check the original dispatch mail for ground truth.","classification":"tactical","recorded_at":"2026-02-17T07:38:57.712Z","evidence":{"commit":"dbca76a"},"id":"mx-814e0a"}
{"type":"convention","content":"Hierarchy lines in scene.ts use LineBasicMaterial with color 0x1a4a6a and opacity 0.6 for visibility against dark background.","classification":"tactical","recorded_at":"2026-02-17T08:10:34.035Z","evidence":{"commit":"404250d"},"id":"mx-24e898"}
{"type":"pattern","name":"completedRemoved-set-fadeout","description":"completedRemoved Set pattern in scene.ts: after fadeout animation removes a node, add name to completedRemoved Set. In updateNode, skip re-adding if completedRemoved.has(name) && state is 'completed'. Allow re-add if state changed (agent restarted). Prune completedRemoved in applySnapshot for names not in snapshot. Clear in dispose().","classification":"tactical","recorded_at":"2026-02-17T08:17:37.205Z","evidence":{"commit":"13863b6"},"id":"mx-5a6f97"}
{"type":"convention","content":"Demo simulator branch (sim-builder) heavily restructured server/index.ts with DEMO_MODE conditional. Cherry-pick approach worked better than merge when main had diverged with other scene.ts fixes.","classification":"tactical","recorded_at":"2026-02-17T08:28:48.710Z","id":"mx-a2f2cf"}
